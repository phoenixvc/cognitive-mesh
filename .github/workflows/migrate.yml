# GitHub Actions Workflow: Migrate
# This workflow is created to prevent or's with dupicate docs or missing docs.

name: PRD Migration Check
on: [pull_request]
jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check if migration tool exists
        id: check_migration
        run: |
          if [ -f "tools/migration/pyproject.toml" ] && [ -f "tools/migration/migrate_prds.py" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "Migration tool not yet implemented, skipping checks."
          fi
      - uses: actions/setup-python@v5
        if: steps.check_migration.outputs.exists == 'true'
        with: { python-version: "3.12" }
      - run: pip install poetry
        if: steps.check_migration.outputs.exists == 'true'
      - run: poetry install
        if: steps.check_migration.outputs.exists == 'true'
        working-directory: tools/migration
      - run: poetry run python migrate_prds.py --batch 25 --dry-run
        if: steps.check_migration.outputs.exists == 'true'
        working-directory: tools/migration
